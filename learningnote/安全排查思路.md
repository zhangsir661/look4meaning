## Windows

### 排查思路

1、系统运行情况：网络、进程、文件、进程对应账户等

2、系统运行环境：启动项、计划任务、系统服务启动等

3、攻击源：登录记录、不明账户

### 排查操作

#### 1、运行情况

查看系统资源使用情况：**任务管理器、资源监视器（服务器版本）**

网络会话情况：**netstat -ano**查看端口开放、网络连接情况，以及会话关联的进程ID

可配合 **findstr**命令

进程-文件：通过任务管理器详细信息根据对应PID查到对应进程以及文件所在位置

账户：**net user**查看系统账户

计算机管理->本地用户和组

服务器版本通过powershell界面查看

#### 2、运行环境

启动项：**msconfig**打开系统配置，在服务和启动标签下进行查看和管理

计划任务：计算机管理->任务计划程序

#### 3、攻击源

**远程登录**情况：

事件查看器->Windows日志->安全

在筛选当前日志中，所有事件ID一栏中，输入2624筛选登录成功的日志信息，2625筛选登录失败的日志信息；在登陆成功的信息详情中，排查登录类型为10的日志条目，可查看远程登录成功的IP地址

## Linux

### 排查思路

1、系统运行情况：网络、进程、文件、进程对应账户等

2、系统运行环境：启动项、计划任务、系统服务启动等

3、攻击源：登录日志、运行日志，passwd、shadow文件

4、历史操作指令

### 排查操作

#### 1、运行情况

进程：**ps aux** 查看当前运行进程

**ll /proc/PID号/exe** 查看进程对应的执行程序

**lsof -p PID号** 查看进程涉及文件的信息

网络：**netstat -anput**查看系统的网络连接情况，以及对应程序和进程ID

资源使用：**top、free**查看进程cpu、内存等情况

**ps aux|head -1;ps aux| grep -v PID|sort -rn -k +4|head**命令查看占用内存资源的进程情况

**pmap -x PID**查看指定进程占用内存资源

账户：**grep -v nologin/etc/passwd**查看具有登录系统权限的账户，重点排查**uid在1000含以上**的账户；

文件：通过 **stat /etc/passwd**查看**passwd**文件是否被修改

#### 2、运行环境

启动项：**chkconfig --list**查看系统启动项

其中，等级0表示关机、等级1表示单用户模式、等级2表示无网络连接的多用户命令行模式、等级3表示有网络连接的多用户命令行模式、等级4表示不可用、等级5表示带图形界面的多用户模式、等级6表示重新启动。

系统启动时启动的服务：**systemctl list-unit-files | grep enabled**

系统启动脚本：**ll /etc/init.d/**

**/etc/init.d/**路径存放服务脚本，当Linux启动时，会寻找这些目录中的服务脚本，并根据脚本的run level确定不同的启动级别。

全局环境变量：**echo $PATH**

查看有无可疑的命令执行路径

计划任务：**crontab -l**和**cat /etc/crontab**查看系统计划任务

“**crontab -l**”命令可査看用户级计划任务;“**cat /etc/crontab**”命令可查看系统级计划任务。

#### 3、攻击源

登录情况：last查看近期登录账户记录

**grep 'Accepted' /var/log/secure**查看是否有可疑IP登录机器成功

执行 **last** 命令时，读取的是/var/log 目录下的 wtmp 文件，可以查看登录 IP、账户、时间、在线时长等信息;
执行 **less** 命令时，读取的是/var/log 目录下的 secure 文件，可以査看登录系统的 IP、端口等信息。

通过**cat /var/log/secure | grep Failed**命令，查看是否存在暴力破解行为

#### 4、操作

历史操作指令：**history**查看某用户历史操作指令，是否存在恶意操作

停闭进程：**kill -9 PID** 强行终止进程

**kill -STOP PID** 暂停进程

**kill -u 用户名** 停止某用户的所有进程

删除恶意文件：**rm -rf 文件(夹)** 强行删除文件(夹) 